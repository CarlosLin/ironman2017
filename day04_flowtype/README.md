# Flow - JavaScript靜態類型檢查工具

`flowtype`正如其名 - `流動的類型`，是個對JavaScript的靜態類型檢查工具，FB出品，問世一年多。

本文大部份內容改寫自之前我寫的部落格文章 - [Flow靜態資料類型的檢查工具，10分鐘快速入門](http://eddychang.me/blog/javascript/90-flowtype-10-min.html)。

## 注意事項

> "奇異博士"說過「使用警語應該要加註在書的內容的前面」。所以我加在這裡

- 由於flowtype還是個年輕的專案，問題仍然很多，功能也沒你想像中完整。對Windows平台的支持也是二個月前(2016.8)時的事，可能使用時會有一些問題是正常的，但它會愈來愈好。
- 如果你是要學或用React或vue.js等等，flowtype是必學的，不管你要用不用，原始碼裡面都用了，不學你可能會看不太懂在寫什麼。

## 介紹

會有這類解決方案，起因是JavaScript是一種弱(動態)資料類型的語言，弱(動態)資料類型代表在程式碼中，變數或常數會自動依照指定值變更資料類型，而且類型種類也很少，這是直譯式腳本語言的常見特性，但有可能是優點也是很大的缺點。優點可能是容易使用，缺點是像開發者經常會因為指定值或傳入值的類型錯誤，造成不如預期的結果。有些時候在使用框架或函式庫時，如果眼花沒有仔細看文件，亦或是文件寫得不清不楚，也容易造成誤用的情況。

這個缺點在具規模化的應用中，會顯得更加嚴重。我們在團隊的協同開發中，一般都是用詳盡的文字說明，來降低這個問題的發生，但語言本身無法阻止這些問題。而且說明文件也需要花時間額外編寫，其他的開發者閱讀也需要花時間。在現在預先編譯器流行的年代，像TypeScript這樣的強(靜態)類別的JavaScript超集語言就開始流行，用嚴格的角度與以JavaScript語言為基底，來打造另一套具有強(靜態)類型特性的語言，就如同Java或C#這些語言一樣，這也是為什麼稱為企業級的開發JavaScript解決方案。

> 註: 強(靜態)類型語言，意思是可以讓變數或常數在宣告(定義)時，就限定好只能使用哪種類型，之後在使用時如果發生類型不相符時，就會發出錯誤警告，但不只如些，裡面也擴充了更多的類型與語法。

TypeScript自然有它的市場，但它有一些明顯的問題，首先是JavaScript開發者需要進一步學習，內容不少也有一定的學習曲線，不過這還算小事。大條的事情是需要把已經正在使用的應用代碼，都要整個改用TypeScript程式碼語法，才能發揮完整的功效。這對很多已有自己內部程式碼庫的大型應用團隊而言，將會是個重大的決定，因為如果不往全面更新的路，無法發揮強(靜態)類型的最大效用。所以這對許多現行的開放原始碼函式庫或框架，不會直接使用TypeScript作為程式碼的語言會有類似理由，另一方面當然是TypeScript並非使用者眾多的程式語言，在超集語言中也有其他的類似語言。當然，TypeScript提出了DefinitelyTyped的解決方式之後，讓現有的函式庫能額外定義出裡面使用的類型，這也是另一個可以與現有框架與庫相整合的方案。另一個優勢是，TypeScript也是個活躍的開放原始碼專案，它的背後有微軟(MS)的支持。

現在，flowtype提供了另一個新的選項，它是一種強(靜態)類型的輔助檢查工具。flowtype的功能是讓現有的JS語法可以先作類型的聲明(定義)，在開發過程中進行自動檢查，當然在最後編譯時，可以用babel工具來移除這些標記。

相較於TypeScript是另外重新制定一套語言，最後再經過編譯為JS代碼來執行。flowtype走的則是非強制與非侵入性的路線。flowtype的優點是易學易用，它的學習曲線沒有TypeScript來得高，雖然內容也很多，但大概一天之內學一學就可以漸進式地開始使用。而且因為它從頭到尾只是個檢查工具，不是新的重制語言或超集語言，所以它可以與各種現有的JavaScript代碼相容。當然，flowtype的功用可能無法像TypeScript這麼地全面性，也不可能改變作某些事情的基本語法結構。

總結來說，這兩種方式的目的是相似的，各自有優點也有不足之處，青菜蘿蔔各有所好，要選擇哪一種方式就看你的選擇。

## 實際案例

這種類型不符的情況在程式碼中非常容易發生，例如以下的例子:

```js
function foo(x) {
  return x + 10
}

foo('Hello!')
```

`x`這個傳入參數，我們在函數聲明(定義)時希望它是個數字類型，但最後使用呼叫函式時則用了字串類型。最後的結果會是什麼嗎？ "Hello!10"，這是因為加號(+)在JavaScript語言中，除了作為數字的加運算外，也可以當作字串的串接運算。想當然這並不是我們想要的結果。

聰明如你應該會想要用類型來當傳入參數的識別命名，像下面這樣:

```js
function foo(number) {
  return number + 10
}
```

但如果在複合類型的情況，例如這個傳入參數的類型可以是數字也可以是布林，你又要如何寫得清楚？更不用說是個複雜的物件類型時。另外還有函數的回傳類型又該如何來聲明？

由這個小例子你可以想見，如果在多人協同開發某個大的JavaScript應用時，這種類型的輸出輸入問題，會需要花多少時間來進行溝通與明確的文件化，而且文件化也只能提供說明，語言本身並無法檢查各種情況。
